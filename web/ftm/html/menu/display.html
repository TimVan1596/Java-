<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>显示DVD - BiggerDVD</title>
    <style>
        td {
            text-align: center;
            white-space: nowrap;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- DVD信息（列表填充模板 template）-->
    <script type="text/html" id="DVD_TEMPLATE">
        <tr class="dvd-tr-line">
            <td class="dvd-radio">
                <input class="dvd-radio-input" name="dvd-radio"
                       type="radio" value=""/>
            </td>
            <td class="dvd-id"></td>
            <td class="dvd-name"></td>
            <td class="dvd-status"></td>
            <td>
                <button class="dvd-btn-land"
                        onclick="loanOrReturnDVD(this)"></button>
            </td>
        </tr>
    </script>

</head>
<body>


<h1>********** 显示当前所有DVD信息 **************</h1>


<table border="1" id="DVDsTable">
    <tr>
        <th></th>
        <th>编号</th>
        <th width="200">名称</th>
        <th width="100">状态</th>
        <th width="100">操作</th>
    </tr>
    <!--填充模板区-->
</table>

<script>
    //初始化页面
    $(function () {

        var ALL_STATUS = -1;

        //通过ajax获取每一行
        $.post('GetAllDVDs.do', {
            status: ALL_STATUS
        }, function (ret) {
            //解析ret
            ret = eval("(" + ret + ")");

            if (ret['error'] === 0) {
                var dvdArr = ret['dvdArr'];
                for (var i = 0; i < dvdArr.length; i++) {
                    //获取到DVD的信息
                    var DVD = dvdArr[i];
                    var id = DVD['id'];
                    var name = DVD['name'];
                    var status = DVD['status'];

                    //创造DVD节点(tr)
                    var $tr = $("#DVD_TEMPLATE").html();
                    $("#DVDsTable").append($tr);
                    //填充文字
                    $('.dvd-id:last').text(id);

                    //单选框补id
                    var $dvdRadio = $('.dvd-radio-input:last');
                    $dvdRadio.attr("value", id);
                    //单选框第一个checked
                    if (i === 0) {
                        $dvdRadio.attr("checked", "checked");
                    }

                    $('.dvd-name:last').text(name);
                    $('.dvd-status:last').text(
                        status ? '已借出' : '未借出'
                    );
                    $('.dvd-btn-land:last').text(
                        status ? '归还' : '借出'
                    );


                }

            }
        });
    });

    //添加DVD
    function addDVD() {

        var name = prompt("请输入要添加的DVD名称？");

        //判断用户是否输入内容
        if (name) {
            $.post('AddDVD.do', {
                name: name
            }, function (ret) {
                //解析ret
                ret = eval("(" + ret + ")");

                if (ret['error'] === 0) {
                    window.location.reload();
                }
                else {
                    var errorInfo = ret['errorInfo'];
                    alert("添加失败！" + errorInfo);
                }
            });

        }

    }

    //编辑DVD信息
    function editDVD() {
        var dvdID = $('input[name="dvd-radio"]:checked').val();
        var name = prompt("请输入DVD的新名称");

        //判断用户是否输入内容
        if (name) {
            $.post('EditDVD.do', {
                name: name,
                id:dvdID
            }, function (ret) {
                //解析ret
                ret = eval("(" + ret + ")");

                if (ret['error'] === 0) {
                    window.location.reload();
                }
                else {
                    var errorInfo = ret['errorInfo'];
                    alert("编辑失败！" + errorInfo);
                }
            });

        }
    }

    //删除DVD信息
    function deleteDVD(){
        var dvdID = $('input[name="dvd-radio"]:checked').val();

        var deleteConfirm =confirm("是否确认删除DVD信息");
        if ( deleteConfirm === true){
            $.post('DeleteDVD.do', { id:dvdID}, function (ret) {
                //解析ret
                ret = eval("(" + ret + ")");

                if (ret['error'] === 0) {
                    window.location.reload();
                }
                else {
                    var errorInfo = ret['errorInfo'];
                    alert("删除失败！" + errorInfo);
                }
            });
        }

    }

    //借入/还回DVD操作
    function loanOrReturnDVD(obj){
        var dvdID = $('input[name="dvd-radio"]:checked').val();


        var LorRConfirmTips =
            (obj.innerHTML === '借出' ? '归还':'借出');

        var LorRConfirm =confirm('是否确定'+LorRConfirmTips+'DVD');
        if ( LorRConfirm === true){
            $.post('LoanOrReturnDVD.do', { id:dvdID}, function (ret) {

                //解析ret
                ret = eval("(" + ret + ")");

                if (ret['error'] === 0) {
                    window.location.reload();
                }
                else {
                    var errorInfo = ret['errorInfo'];
                    alert("操作失败！" + errorInfo);
                }

            });
        }

    }
</script>


</body>
</html>